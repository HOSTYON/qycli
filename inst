#!/bin/bash

[[ $(whoami) != "root" ]] && echo "qycli has to be installed as root, try 'sudo -i' or 'su -' to become root, then try again." && exit

install_git() {
    apt update
    apt -y install git
}

## Install qycli and stack with "wget -qO- qyc.li/inst | bash"
inst_qycli() {
    cd /opt
    git clone --branch <branchname> https://github.com/HOSTYON/qycli
    cp /opt/qycli/bin/qyc /usr/bin/qyc
    chmod 755 /usr/bin/qyc
    source /opt/qycli/stk
    source /opt/qycli/help
    printf "
    qycli (production) was installed.
    Installing the stack now.\n\n"
    stk_install
}

## Install qycli dev version with "wget -qO- qyc.li/inst | bash -s dev"
inst_dev() {
    if ! command -v svn &> /dev/null; then
        apt update && apt -y install subversion
    fi
    svn export --force https://github.com/HOSTYON/qycli/trunk /opt/qycli/
    mv /opt/qycli/bin/qyc /usr/bin/qyc && chmod 755 /usr/bin/qyc
    printf "\nqycli (dev) was installed/updated.\n\n"
}

if [[ "$1" == "prod" || "$1" == "" ]]; then
    wget -qO- qyc.li/host | bash
    install_git
    inst_qycli
elif [[ "$1" == "dev" ]]; then
    wget -qO- qyc.li/host | bash
    install_git
    inst_dev
fi
