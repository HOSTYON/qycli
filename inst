#!/bin/bash

[[ $(whoami) != "root" ]] && echo "qycli has to be installed as root, try 'sudo -i' or 'su -' to become root, then try again." && exit

## Install qycli and stack with "wget -qO- qyc.li/inst | bash" and optimize the host if you are in a container with "wget -qO- qyc.li/host | bash"
inst_qycli() {
    [[ -f /usr/bin/qyc ]] && echo "qycli is already installed, stopping the process." && exit
    apt update && apt -y install git wget curl
    git -C /opt clone -b $branch_name https://github.com/HOSTYON/qycli
    cp /opt/qycli/bin/qyc /usr/bin/qyc
    chmod 755 /usr/bin/qyc
    chmod 755 /opt/qycli/host
    source /opt/qycli/stk
    source /opt/qycli/help
    printf "\nqycli ($branch_name) was installed.
    Installing the stack now.
    Optimizing kernel configurations. You should restart after the installation.\n\n"
    bash /opt/qycli/host
    echo "Installing the qycli stack."
    stk_install
}

if [[ "$1" == "production" || "$1" == "prod" || "$1" == "" ]]; then
    branch_name=production
    inst_qycli
elif [[ "$1" == "beta" ]]; then
    branch_name=beta
    inst_qycli
elif [[ "$1" == "dev" ]]; then
    branch_name=dev
    inst_qycli
fi
